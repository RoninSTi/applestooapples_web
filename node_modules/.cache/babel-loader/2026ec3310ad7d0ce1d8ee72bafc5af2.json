{"ast":null,"code":"import _regeneratorRuntime from \"/Users/craigcronin/Development/applestooapples_web_template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/craigcronin/Development/applestooapples_web_template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/craigcronin/Development/applestooapples_web_template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/Users/craigcronin/Development/applestooapples_web_template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/craigcronin/Development/applestooapples_web_template/src/contexts/SwoopAuthContext.js\";\n\nimport React, { createContext, useEffect, useReducer } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport * as QueryString from 'query-string';\nimport { useLocation } from 'react-router-dom';\nimport SplashScreen from 'src/components/SplashScreen';\nimport api from 'src/utils/api';\nvar initialAuthState = {\n  isAuthenticated: false,\n  isInitialised: false,\n  user: null\n};\n\nvar isValidToken = function isValidToken(accessToken) {\n  if (!accessToken) {\n    return false;\n  }\n\n  var decoded = jwtDecode(accessToken);\n  var currentTime = Date.now() / 1000;\n  return decoded.exp > currentTime;\n};\n\nvar setSession = function setSession(accessToken) {\n  if (accessToken) {\n    localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = \"Bearer \".concat(accessToken);\n  } else {\n    localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'INITIALISE':\n      {\n        var _action$payload = action.payload,\n            isAuthenticated = _action$payload.isAuthenticated,\n            user = _action$payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: isAuthenticated,\n          isInitialised: true,\n          user: user\n        });\n      }\n\n    case 'LOGIN':\n      {\n        var _user = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user\n        });\n      }\n\n    case 'LOGOUT':\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: false,\n          user: null\n        });\n      }\n\n    case 'REGISTER':\n      {\n        var _user2 = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user2\n        });\n      }\n\n    default:\n      {\n        return _objectSpread({}, state);\n      }\n  }\n};\n\nvar AuthContext = createContext(_objectSpread(_objectSpread({}, initialAuthState), {}, {\n  method: 'Swoop',\n  login: function login() {\n    return Promise.resolve();\n  },\n  logout: function logout() {},\n  magic: function magic() {},\n  register: function register() {\n    return Promise.resolve();\n  }\n}));\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n\n  var _useReducer = useReducer(reducer, initialAuthState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var _useLocation = useLocation(),\n      search = _useLocation.search;\n\n  var params = QueryString.parse(search);\n\n  var magic = function magic() {\n    window.open(\"\".concat(process.env.REACT_APP_API_BASE_URL, \"auth/swoop\"), '_self');\n  };\n\n  var login = useCallBack( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(code, state) {\n      var response, _response$data, accessToken, user;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return api.post('/auth/login', {\n                code: code,\n                state: state\n              });\n\n            case 2:\n              response = _context.sent;\n              _response$data = response.data, accessToken = _response$data.accessToken, user = _response$data.user;\n              setSession(accessToken);\n              dispatch({\n                type: 'LOGIN',\n                payload: {\n                  user: user\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n  useEffect(function () {\n    var code = params.code,\n        authState = params.state;\n\n    if (code && authState && !state.isAuthenticated) {\n      login(code, authState);\n    }\n  }, [login, params, state]);\n\n  var logout = function logout() {\n    setSession(null);\n    dispatch({\n      type: 'LOGOUT'\n    });\n  };\n\n  var register = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, name, password) {\n      var response, _response$data2, accessToken, user;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return axios.post('/api/account/register', {\n                email: email,\n                name: name,\n                password: password\n              });\n\n            case 2:\n              response = _context2.sent;\n              _response$data2 = response.data, accessToken = _response$data2.accessToken, user = _response$data2.user;\n              window.localStorage.setItem('accessToken', accessToken);\n              dispatch({\n                type: 'REGISTER',\n                payload: {\n                  user: user\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function register(_x3, _x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var initialise = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var accessToken, response, user;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                accessToken = window.localStorage.getItem('accessToken');\n\n                if (!(accessToken && isValidToken(accessToken))) {\n                  _context3.next = 11;\n                  break;\n                }\n\n                setSession(accessToken);\n                _context3.next = 6;\n                return axios.get('/api/account/me');\n\n              case 6:\n                response = _context3.sent;\n                user = response.data.user;\n                dispatch({\n                  type: 'INITIALISE',\n                  payload: {\n                    isAuthenticated: true,\n                    user: user\n                  }\n                });\n                _context3.next = 12;\n                break;\n\n              case 11:\n                dispatch({\n                  type: 'INITIALISE',\n                  payload: {\n                    isAuthenticated: false,\n                    user: null\n                  }\n                });\n\n              case 12:\n                _context3.next = 18;\n                break;\n\n              case 14:\n                _context3.prev = 14;\n                _context3.t0 = _context3[\"catch\"](0);\n                console.error(_context3.t0);\n                dispatch({\n                  type: 'INITIALISE',\n                  payload: {\n                    isAuthenticated: false,\n                    user: null\n                  }\n                });\n\n              case 18:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[0, 14]]);\n      }));\n\n      return function initialise() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    initialise();\n  }, []);\n\n  if (!state.isInitialised) {\n    return /*#__PURE__*/React.createElement(SplashScreen, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 12\n      }\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(AuthContext.Provider, {\n    value: _objectSpread(_objectSpread({}, state), {}, {\n      method: 'Swoop',\n      login: login,\n      logout: logout,\n      magic: magic,\n      register: register\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 5\n    }\n  }, children);\n};\nexport default AuthContext;","map":{"version":3,"sources":["/Users/craigcronin/Development/applestooapples_web_template/src/contexts/SwoopAuthContext.js"],"names":["React","createContext","useEffect","useReducer","jwtDecode","QueryString","useLocation","SplashScreen","api","initialAuthState","isAuthenticated","isInitialised","user","isValidToken","accessToken","decoded","currentTime","Date","now","exp","setSession","localStorage","setItem","axios","defaults","headers","common","Authorization","removeItem","reducer","state","action","type","payload","AuthContext","method","login","Promise","resolve","logout","magic","register","AuthProvider","children","dispatch","search","params","parse","window","open","process","env","REACT_APP_API_BASE_URL","useCallBack","code","post","response","data","authState","email","name","password","initialise","getItem","get","console","error"],"mappings":"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","sourcesContent":["import React, {\n  createContext,\n  useEffect,\n  useReducer\n} from 'react';\nimport jwtDecode from 'jwt-decode';\nimport * as QueryString from 'query-string'\nimport { useLocation } from 'react-router-dom'\nimport SplashScreen from 'src/components/SplashScreen';\nimport api from 'src/utils/api';\n\n\nconst initialAuthState = {\n  isAuthenticated: false,\n  isInitialised: false,\n  user: null\n};\n\nconst isValidToken = (accessToken) => {\n  if (!accessToken) {\n    return false;\n  }\n\n  const decoded = jwtDecode(accessToken);\n  const currentTime = Date.now() / 1000;\n\n  return decoded.exp > currentTime;\n};\n\nconst setSession = (accessToken) => {\n  if (accessToken) {\n    localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'INITIALISE': {\n      const { isAuthenticated, user } = action.payload;\n\n      return {\n        ...state,\n        isAuthenticated,\n        isInitialised: true,\n        user\n      };\n    }\n    case 'LOGIN': {\n      const { user } = action.payload;\n\n      return {\n        ...state,\n        isAuthenticated: true,\n        user\n      };\n    }\n    case 'LOGOUT': {\n      return {\n        ...state,\n        isAuthenticated: false,\n        user: null\n      };\n    }\n    case 'REGISTER': {\n      const { user } = action.payload;\n\n      return {\n        ...state,\n        isAuthenticated: true,\n        user\n      };\n    }\n    default: {\n      return { ...state };\n    }\n  }\n};\n\nconst AuthContext = createContext({\n  ...initialAuthState,\n  method: 'Swoop',\n  login: () => Promise.resolve(),\n  logout: () => { },\n  magic: () => { },\n  register: () => Promise.resolve()\n});\n\nexport const AuthProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialAuthState);\n\n  const { search } = useLocation()\n\n  const params = QueryString.parse(search)\n\n  const magic = () => {\n    window.open(`${process.env.REACT_APP_API_BASE_URL}auth/swoop`, '_self')\n  }\n\n  const login = useCallBack(async (code, state) => {\n    const response = await api.post('/auth/login', { code, state });\n    const { accessToken, user } = response.data;\n\n    setSession(accessToken);\n    dispatch({\n      type: 'LOGIN',\n      payload: {\n        user\n      }\n    });\n  });\n\n  useEffect(() => {\n    const { code, state: authState } = params\n\n    if (code && authState && !state.isAuthenticated) {\n      login(code, authState)\n    }\n  }, [login, params, state])\n\n  const logout = () => {\n    setSession(null);\n    dispatch({ type: 'LOGOUT' });\n  };\n\n  const register = async (email, name, password) => {\n    const response = await axios.post('/api/account/register', {\n      email,\n      name,\n      password\n    });\n    const { accessToken, user } = response.data;\n\n    window.localStorage.setItem('accessToken', accessToken);\n\n    dispatch({\n      type: 'REGISTER',\n      payload: {\n        user\n      }\n    });\n  };\n\n  useEffect(() => {\n    const initialise = async () => {\n      try {\n        const accessToken = window.localStorage.getItem('accessToken');\n\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n\n          const response = await axios.get('/api/account/me');\n          const { user } = response.data;\n\n          dispatch({\n            type: 'INITIALISE',\n            payload: {\n              isAuthenticated: true,\n              user\n            }\n          });\n        } else {\n          dispatch({\n            type: 'INITIALISE',\n            payload: {\n              isAuthenticated: false,\n              user: null\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: 'INITIALISE',\n          payload: {\n            isAuthenticated: false,\n            user: null\n          }\n        });\n      }\n    };\n\n    initialise();\n  }, []);\n\n  if (!state.isInitialised) {\n    return <SplashScreen />;\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{\n        ...state,\n        method: 'Swoop',\n        login,\n        logout,\n        magic,\n        register\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;"]},"metadata":{},"sourceType":"module"}